<!-- HTML header for doxygen 1.8.3.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<title>DirectOutput: DOF Build Setup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="directoutputstyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="DirectOutputR3_Small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">DirectOutput
   </div>
   <div id="projectbrief">DirectOutput framework R3 for virtual pinball cabinets.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__d_1_2a_2_direct_output_2_direct_output_2_r_e_a_d_m_e___build_setup.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">DOF Build Setup </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md20"></a></p>
<p>The build is set up for Visual Studio 2022. To perform a build, start Visual Studio, and load the DOF solution (.sln) file. It should take care of the build dependency ordering.</p>
<p>If you want to be able to build the MSI installer, a free third-party tool called WiX Toolset is required, and must be installed manually. The MSI installer is the last build step, so if you don't want to bother with WiX, you can still build everything else; just ignore the errors on the last step where VS tries to build the MSI.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md21"></a>
Migrating to newer Visual Studio versions</h1>
<p>Moving a project to a newer version of Visual Studio is usually pretty easy, but be aware that a newer Visual Studio might prompt you to change project settings to update build tool versions and/or .NET component versions. If you accept those changes, <b>they will modify the build</b> and therefore might make it harder to merge your changes into other people's forks.</p>
<p>Updates to .NET components require careful consideration because of the effect they can have on deployment compatibility. Some people use DOF with older Windows versions, so a .NET update that only works with Windows 11, say, would lock out a lot of users. The virtual pin cab community doesn't have any sort of official support policy that says which versions of Windows are still supported - we're just an informal coalition of open-source developers, after all - but we generally try to keep supporting older systems for longer than Microsoft does. So .NET updates from Microsoft might well exclude older systems that are still important to pin cab users.</p>
<p>If you do feel that a build tool update or .NET component update is in order, it's helpful to <b>create a pull request or commit just for the tooling changes</b>. That's useful because it makes it easy to test <b>just</b> the project file changes, in case a new bug appears afterward. If the project file changes are mixed into the same commit with other changes, it's harder to isolate whether the bug is coming from the tool updates or the actual code changes.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md22"></a>
WiX setup (optional - required only for .msi creation)</h1>
<p>The WiX toolset requires installing two separate packages:</p>
<p>1. Install the WiX command-line tools from the github release page: <a href="https://github.com/wixtoolset/wix3/releases">https://github.com/wixtoolset/wix3/releases</a>. Grab the .EXE for version <b>3.14.0</b>, which is a self-installer; run it and you'll be set. <b>WARNING: Do not install 3.14.1;</b> see below.</p>
<p><b>Important:</b> As of this writing, you <b>MUST</b> use WiX version <b>3.14.0</b>. I can't tell you how much I hate it when open-source projects require installing a specific out-of-date version of some tool; it's a sure sign that it's going to be a nightmare to get the build working, and that probably even the original developers aren't sure how the build really works. So let me explain why I'm asking the same thing, and why it's necessary in this case. The <a class="el" href="namespace_direct_output.html">DirectOutput</a> MSI builder is written in WiX v3, and Wix 3.14.0 is the last release on the WiX v3 branch that works. It's the last version of v3 that will <b>ever</b> work, because the WiX developers have stated publicly that they've discontinued v3 work and will never release any more patches on that branch, <em>even though</em> the final v3 release, 3.14.1, contains a known bug that makes it produce non-working installs. (Installs produced with 3.14.1 fail in a particularly spectacular way, leaving your registry hosed and requiring manual cleanup. Avoid at all costs.) WiX has moved on to v4 and v5, but those are thoroughly incompatible with v3 scripts, requiring a substantial rewrite. I've investigated doing that, but decided that I'm not willing at this time because it's basically starting from scratch, and the new WiX language is essentially undocumented. It would be a lot of work even if WiX v4/5 were documented, but the lack of documentation makes it simply out of the question for me right now. If anyone wants to volunteer, though...</p>
<p>Note that the non-working WiX 3.14.1 contains fixes for two security vulnerabilities that are considered severe enough that the WiX developers advise against using any earlier version. (They also don't expect you to use 3.14.1, given the show-stopping new bug mentioned above; they seem to consider v3 as a whole fully bricked at this point.) After studying the release notes for the 3.14.1 security fixes, I concluded that the vulnerabilities don't affect the DOF MSI, because they're only triggered when invoking specific commands that the DOF MSI doesn't use. So I consider 3.14.0 safe for DOF use.</p>
<p>2. Install the WiX add-in tools for Visual Studio. This is done within Visual Studio: on the main menu, select <a class="el" href="namespace_extensions.html">Extensions</a> &gt; Manage <a class="el" href="namespace_extensions.html">Extensions</a> to bring up the Extension Manager window. Select the Browse tab in the window. Type <b>Wix v3</b> into the search box. Find <b>Wix v3 - Visual Studio 2022 Extension</b> in the result list. Click the Install button.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md23"></a>
Build procedure</h1>
<p>Build from the Visual Studio GUI as follows:</p>
<ol type="1">
<li>In the configuration selector in the main toolbar, select the <b>Debug</b> or <b>Release</b> build as desired. (Most past DOF releases were built in Debug mode. This isn't a very professional practice, but it's well-intentioned, in the hope of protecting users from any surprises from differences in behavior between the Debug build, which is typically well tested in the sense that it's what the developers have been routinely running as they worked on it, and the Release build, which they typically haven't run much, if at all. In an ideal world, the Release build would work exactly like the Debug build, just being faster and smaller, but compilers aren't always perfect at achieving identical behavior across the two configurations. An alternative ideal world would be one in which DOF is well staffed with QA engineers who've thoroughly tested the Release configuration, but that's another ideal that is not always realized in practice.)</li>
<li>In the configuration selector, choose the desired build architecture, <b>x86</b> or <b>x64</b>. Each must be built separately. <b>Build x86 first, then x64</b> (see below).</li>
<li>On the main menu, Build &gt; Clean Solution</li>
<li>On the main menu, Build &gt; Build Solution</li>
</ol>
<p>This should build all of the DOF binaries plus the .msi installers, depositing the target files in various subfolders.</p>
<p><b>The build order is important:</b> Build the <b>x86</b> version <b>first</b>, then build the x64 version. Due to limitations of the WiX tools, the WiX setup builder for 64-bit has to read from some of the x86 target files, so they have to exist before the x64 build will complete successfully. It's a stupid and fragile setup, I know, but I can't find any other workaround for the WiX issue. And Visual Studio unfortunately doesn't have any way that I know of to carry out the x86 and x64 builds in sequence, so you just have to know to run the two builds manually in that order.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md24"></a>
Release process</h1>
<p>The release consists of a set of .msi files (Microsoft Setup install bundles) and .zip files.</p>
<p>The .msi files are stand-alone MS Setup release bundles, containing all of the necessary files to perform a complete install. These are ready for distribution to users without any further packaging. A user simply downloads the .msi file and double-clicks it, which will launch MS Setup and carry out the install.</p>
<p>You can also, optionally, build .zip files containing the install sets, for people who want to do the install by hand rather than using the .msi files. I'm not sure it's worth doing this any more, since the automatic Setup-based install is so much more reliable, but so far I've continued distributing the .zip files out of habit.</p>
<p>If you're checking changes into git for the release, it's a good idea to <b>close Visual Studio</b> before doing your final git commit. Visual Studio sometimes postpones writing changes to the project and solution files (among others) until you exit, no matter how many times you hit Save All.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md25"></a>
New single-script release builder</h2>
<p>The new batch script BuildRelease.bat lets you run the entire build-and-release with a single command. This must run from a CMD (DOS box) windows with the following environment setup:</p>
<ul>
<li>PATH and environment variables for the Visual Studio version you're using</li>
<li>PATH must include a command-line ZIP.EXE tool</li>
</ul>
<p>On Windows 10/11, newer versions of Visual Studio automatically create a "Developer
Command Prompt for VS 20xx" configuration for the Terminal program ("Terminal" is the new name for the CMD.EXE/DOS box on Windows 11). Alternatively, you can use the VCVARS.BAT script that Visual Studio traditionally provides in its own install directory. You must provide your own ZIP.EXE tool in a location on the path.</p>
<p>Once you have the CMD window set up, just CD to the main <a class="el" href="namespace_direct_output.html">DirectOutput</a> source folder and run:</p>
<p>BuildRelease AUTHOR</p>
<p>where AUTHOR is a short name identifying you as the author of this build. I use my initials "mjr" here. This gets embedded in the final .zip and .msi filenames to help people identify their source once released. The point of this is just to make it easier for people to keep track of where a particular download came from, so that if they contact you about a problem, you can sanity-check that they're in fact using a file that you built. Some problems turn out to be as simple as "you're using the wrong download".</p>
<p>BuildRelease performs the following steps:</p>
<ul>
<li>Clean the Release|x86 and Release|x64 configurations</li>
<li>Build the Release|x86 and Release|x6r configurations</li>
<li>Create the release MSI and ZIP files in the .\Builds folder</li>
</ul>
<p>The MSI and ZIP files are named DirectOutput-AUTHOR-CONFIG-release-YYYYMMDD.msi and .zip, where AUTHOR is the AUTHOR tag you included in the BuildRelease command, CONFIG is x86 or x64, and YYYYMMDD is today's date.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md26"></a>
Original manual release process</h2>
<p>Here's the procedure I used before the single .bat script.</p>
<ol type="1">
<li>In Visual Studio, go through each configuration (Debug/x86, Debug/x64, Release/x86, Release/x64) and run a <b>Build &gt; Clean Solution</b>, to make sure that all old build files are removed.</li>
<li>Now go through the configurations <b>in this order</b>: Debug/x86, Debug/x64, Release/x86, Release/x64. For each, run a <b>Build &gt; Build Solution</b>.<ul>
<li>On each build step, it's a good idea to check that the build actually succeeded, by looking at the end of the Output log window, and confirming that it says "=== Build: N succeeded, 0 failed, 0 skipped ===". The important thing is the "0 failed" part.</li>
</ul>
</li>
<li>Run the MakeZip steps (see below)</li>
<li>The Builds\ folder should now have a complete set of .msi and .zip files to upload, with the filenames set to show today's date and thee respective configurations. The file naming makes these suitable for uploading to a simple flat directory structure on a Web server or other repository.</li>
</ol>
<p>How to build the ZIP files: The main folder contains a script, <b>MakebinZip.bat</b>, that builds the .ZIP. Run it from a CMD window after completing the Visual Studio build. You'll need a command-line ZIP tool somewhere on your path, named ZIP.EXE. <br  />
 The script takes three arguments, selecting the binaries by the architecture and build configuration, with a third argument giving a short identifier tag (I use my initials) to embed in the filenames, to help identify their source if you distribute them online.</p>
<div class="fragment"><div class="line">MakeZip x86 debug mjr</div>
<div class="line">MakeZip x86 release mjr</div>
<div class="line">MakeZip x64 debug mjr</div>
<div class="line">MakeZip x64 release mjr</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- HTML footer for doxygen 1.8.3.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on <span class="timestamp"></span> for DirectOutput by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39987816-1']);
    _gaq.push(['_trackPageview']);
    (function () {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
</body>
</html>
